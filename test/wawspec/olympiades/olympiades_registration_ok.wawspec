scenario __FILE__ do
  
  go Waw.config.web_base + 'olympiades/register'
  
  base = {
    :gender      => 'M', 
    :first_name  => 'Test', 
    :last_name   => 'Student Chapter', 
    :mail        => 'test@test.acm-sc.be', 
    :birthdate   => '22/06/1987', 
    :street      => 'Rue de la marche',
    :postal_code => '5000', 
    :city        => 'Namur', 
    :school_name => 'Institut du test', 
    :school_city => '1300 Wavre', 
    :category    => 'secondaire', 
    :study_level => 'INGI21', 
    :center      => 'ucl'
  }
  valid_data = [base, 
                base.merge(:category => 'superieur', :orientation => 'civil'),
                base.merge(:category => 'superieur', :orientation => 'autre', :orientation_other => 'blabla'),
                base.merge(:knowshow => 'affiche'),
                base.merge(:knowshow => 'autre', :knowshow_other => 'blabla'),
                base.merge(:category => 'superieur', :orientation => 'autre', :orientation_other => 'blabla', :knowshow => 'autre', :knowshow_other => 'blabla')]
  invalid_data = [base.merge(:knowshow => 'autre'),
                  base.merge(:category => 'superieur'),
                  base.merge(:orientation => 'blabla'),
                  base.merge(:gender => 'blabla'),
                  base.merge(:category => 'blabla'),
                  base.merge(:center => 'blabla'),
                  base.merge(:birthdate => "00/12/1990"),
                  base.merge(:birthdate => "32/12/1990"),
                  base.merge(:birthdate => "32/00/1990"),
                  base.merge(:birthdate => "32/13/1990"),
                  base.merge(:birthdate => "12/11/1765")]
  
  valid_data.each do |data|
    assert_service_invoke "Successful subscribe service invocation", {
      :service    => "/webserv/olympiades/register",
      :arguments  => data,
      :result     => "success/ok"
    }
  end

  invalid_data.each do |data|
    result = invoke_json_service "/webserv/olympiades/register", data
    assert_equal 'validation-ko', result[0], "Validation-ko on #{data.inspect}"
  end

end