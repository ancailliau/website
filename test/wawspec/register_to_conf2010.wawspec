scenario __FILE__ do
  THIS_EVENT = 'securite_vie_privee_2010'
  people_mail = "test-user@acmscw.be"
  next_mail   = "test-user2@acmscw.be"
  people = {:mail       => people_mail,
            :password   => "mypassword", 
            :newsletter => "true"}
  Waw.resources.business.people.drop_people(people_mail, next_mail)
  Waw.resources.model.people.insert(people.merge(:adminlevel => 0))
  AcmScW::Tools::MailServer.clean(people_mail, next_mail)
  
  assert_not_404 Waw.config.web_base + 'securite-vie-privee/acces'
  assert_form_service_invoke "Successful event registration", {
    :service    => "/webserv/event/register_by_mail",
    :arguments  => {:mail => people[:mail], :event => THIS_EVENT},
    :result     => "success/ok",
    :check_form => false
  }
  
  assert_has_tag "form", :id => 'login'
  assert_service_invoke "Successful login then", {
    :service    => "/webserv/people/login",
    :arguments  => {:mail => people[:mail], :password => people[:password]},
    :result     => "success/ok",
    :check_form => false
  }
  assert_not_404 '/securite-vie-privee/acces'
  assert_i_see Waw.resources.messages.click_here_to_unregister
  
  assert_service_invoke "Successful unsubsription then", {
    :service    => "/webserv/event/unregister_to_this_event",
    :arguments  => {:event => THIS_EVENT},
    :result     => "success/ok"
  }
  assert_not_404 '/securite-vie-privee/acces'
  assert_i_see Waw.resources.messages.click_here_to_register
  
  assert_service_invoke "Successful unsubsription then", {
    :service    => "/webserv/event/register_to_this_event",
    :arguments  => {:event => THIS_EVENT},
    :result     => "success/ok"
  }
  assert_not_404 '/securite-vie-privee/acces'
  assert_i_see Waw.resources.messages.click_here_to_unregister
  
  assert_form_service_invoke "Successful logout then", {
    :service    => "/webserv/people/logout",
    :arguments  => {},
    :result     => "success/ok",
    :check_form => false
  }
  assert_not_404 '/securite-vie-privee/acces'
  assert_has_tag "form", :id => "webserv_event_register_by_mail"
end